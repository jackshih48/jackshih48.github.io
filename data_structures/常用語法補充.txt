================================================== C 語言核心概念筆記：Macro、Inline、Static
巨集 (Macro)

【概念與特色】

由「預處理器 (Preprocessor)」處理，發生在編譯器正式編譯之前。

本質是「純文字替換」，不管傳入什麼型別都會直接展開。

沒有型別檢查，除錯較困難。

致命缺點：容易產生副作用。因為是純文字替換，若傳入帶有遞增/遞減運算子的參數（如 i++），參數可能會被重複執行求值。

【如何使用】
使用 #define 定義，為了避免運算優先級錯誤，通常會加上大量括號。

【程式範例】
#include <stdio.h>

#define SQUARE(x) ((x) * (x))

int main() {
int a = 5;
printf("Result: %d\n", SQUARE(a)); // 正常展開: ((a) * (a)) = 25

// 副作用示範 (危險！)
int i = 5;
// SQUARE(i++) 會被展開為 ((i++) * (i++))
// 這會導致 i 被遞增兩次，且結果是未定義行為。
return 0;
}

內聯函式 (Inline Function)

【概念與特色】

給「編譯器 (Compiler)」的一種最佳化建議。

建議編譯器在呼叫此函式的地方直接將程式碼展開，以省去函式呼叫的額外開銷 (Overhead)。

保有一般函式的所有優點：有嚴格的型別檢查、遵守作用域規則、可單步除錯。

絕對安全：參數在傳入前只會先被求值一次，不會發生巨集的副作用。

現代 C 語言強烈建議用 inline 取代類似函式的巨集 (Function-like macros)。

【如何使用】
在函式回傳型別前加上 inline。在 C 語言中通常會搭配 static 寫成 static inline，避免多檔案編譯時出現重複定義的錯誤。

【程式範例】
#include <stdio.h>

static inline int square(int x) {
return x * x;
}

int main() {
int a = 5;
printf("Result: %d\n", square(a)); // 編譯器可能會直接在這裡展開程式碼

// 安全示範
int i = 5;
int result = square(i++); // i 只會遞增一次，完全符合預期
return 0;
}

靜態保留字 (Static)

【概念與特色】
static 的功能取決於它「放在哪裡」，主要用來控制變數/函式的「生命週期 (Lifetime)」與「可見範圍 (Visibility)」。
共有三種主要用法：

用法一：用於「函式內的區域變數」

功能：延長生命週期。變數不會在函式結束時消失，而是活到程式結束，且只會被初始化一次。能讓函式「記住」上一次的值。

範例：
void count_calls() {
static int count = 0; // 只會在程式啟動時初始化一次
count++;
printf("呼叫次數: %d\n", count);
}

用法二：用於「函式外的全域變數」

功能：縮小可見範圍。將變數隱藏在「當前這個 .c 檔案」中，其他檔案絕對看不到，也無法使用 extern 取得。

用途：避免大型專案中不同檔案的變數名稱衝突，實現私有變數的概念。

範例：
static int secret_password = 1234; // 只有這個檔案內的函式能存取

用法三：用於「函式宣告/定義」

功能：縮小可見範圍。將函式變成當前檔案的「私有函式」，外部檔案無法呼叫。

用途：隱藏模組內部的實作細節，是非常重要的 C 語言軟體架構技巧。

範例：
static void private_helper() {
// 這個函式只能被同一個檔案內的其他函式呼叫
}

==================================================